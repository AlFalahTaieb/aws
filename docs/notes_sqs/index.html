<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">SQS | AWS SAA-C02 Ressources</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="SQS | AWS SAA-C02 Ressources"><meta data-react-helmet="true" name="description" content="export const Quote = ({ children, color }) =&gt; ("><meta data-react-helmet="true" property="og:description" content="export const Quote = ({ children, color }) =&gt; ("><meta data-react-helmet="true" property="og:url" content="https://AlFalahTaieb.github.io/aws/docs/notes_sqs"><link data-react-helmet="true" rel="shortcut icon" href="/aws/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://AlFalahTaieb.github.io/aws/docs/notes_sqs"><link rel="stylesheet" href="/aws/styles.d664286d.css">
<link rel="preload" href="/aws/styles.e3d237d5.js" as="script">
<link rel="preload" href="/aws/runtime~main.5987bc8c.js" as="script">
<link rel="preload" href="/aws/main.db8832c0.js" as="script">
<link rel="preload" href="/aws/2.eacc328a.js" as="script">
<link rel="preload" href="/aws/3.5084f581.js" as="script">
<link rel="preload" href="/aws/66.73ad6aef.js" as="script">
<link rel="preload" href="/aws/67.520034c4.js" as="script">
<link rel="preload" href="/aws/935f2afb.52a1d31c.js" as="script">
<link rel="preload" href="/aws/17896441.17a33e11.js" as="script">
<link rel="preload" href="/aws/7b0dd7dd.69cbd685.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" target="_self" href="/aws/docs/start"><img class="navbar__logo" src="/aws/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">AWS SAA-C02 Ressources</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/aws/docs/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://alfelah.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Taieb</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">üåû</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" target="_self" href="/aws/docs/start"><img class="navbar__logo" src="/aws/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">AWS SAA-C02 Ressources</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/aws/docs/">Docs</a></li><li class="menu__list-item"><a href="https://alfelah.com" target="_blank" rel="noopener noreferrer" class="menu__link">Taieb</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">AWS Certified Solutions Architect Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/start">Getting Started üèéÔ∏è</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/raz">Regions &amp; AZ</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_sg">Security Groups</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_iam">IAM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_ec2">EC2</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_asg">ASG</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_elb">ELB</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_ebs_efs">EBS &amp; EFS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_fsx">FSx</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_s3">S3</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_storage_ex">Storage Extras</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_athena">Athena</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_datasync">DataSync</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_cli_sdk">CLI &amp; SDK</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_rds">RDS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_redshift">Redshift</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_lambda">Lambda</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_dynamodb">DynamoDB</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_apig">API Gateway</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_cognito">Cognito</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_ec">ElastiCache</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_r53">Route 53</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_cf">CloudFront</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_bs">BeanStalk</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/aws/docs/notes_sqs">SQS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_sns">SNS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_kenesis">Kenesis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_cw">CloudWAtch</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_ct">CloudTrail</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_kms">KMS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_ssm">SSM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_sw">Shield &amp; WAF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_vpc">VPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_ecs">ECS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_cfm">CloudFormation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_ss">SWF &amp; Step Function</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_os">Other Services</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_dr">Disaster Recovery</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_hpc">HPC</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes_fp">Five Pillars</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/aws/docs/notes">Notes for AWS Certified Solutions Architect Associate</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">SQS</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="i-introduction"></a>I. Introduction<a aria-hidden="true" tabindex="-1" class="hash-link" href="#i-introduction" title="Direct link to heading">#</a></h2><ol><li><p>Oldest AWS service, used to decouple applications.</p></li><li><p><strong>Unlimited throughput and number of messages in the queue.</strong></p></li><li><p><strong>Scales automatically, millions and millions of messages.</strong></p></li><li><p>Default retention of messages is 4 days (max 14 days)</p></li><li><p>Low latency (&lt;10ms on publish and receive)</p></li><li><p>Limitation of 256KB per message sent including XML, JSON and unformatted text.</p></li><li><p>Can have duplicate messages (at least once delivery).</p></li><li><p>Best effort message ordering</p></li><li><p>Producers</p><ol><li>Send message using SDK</li><li>Gets persisted in SQS</li></ol></li><li><p>Consumers</p><ol><li><strong>Apps running on EC2, Lambda etc</strong></li><li>Polls SQS for messages</li><li>Receive up to 10 messages at a time</li><li>Process the messages (write to RDS)</li><li>Delete the message</li></ol></li></ol><p><img alt="SQS AWS" src="/aws/assets/images/sqs-a2763d10eaf78750fb775665b55ebf28.png"></p><ol start="11"><li>SQS plays nicely with ASG<ol><li>ASG can add/remove EC2 based on queue length</li><li>The info is provided by a CloudWatch metric</li></ol></li></ol><p><img alt="SQS AWS" src="/aws/assets/images/sqs1-c3181cd40d699bd6e16a3c964406cdd5.png"></p><ol start="12"><li><p>Security</p><ol><li>In-flight encryption with HTTPS API</li><li>At-rest using KMS</li><li>Client-side available as well</li></ol></li><li><p>IAM policies to regulate access to SQS API.</p></li><li><p>SQS Access Policies (similar to S3 bucket policies) that are useful for cross-account SQS queues.</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="ii-message-visibility-timeout"></a>II. Message Visibility Timeout<a aria-hidden="true" tabindex="-1" class="hash-link" href="#ii-message-visibility-timeout" title="Direct link to heading">#</a></h2><ol><li>Once a message is polled by a consumer, it becomes &quot;invisible&quot; to other consumers.</li><li>By default, the &quot;message visibility timeout&quot; is 30s which means the message has 30s to get processed (and deleted).</li><li>If the message is not processed within 30s, it will be &quot;visible&quot; again.</li></ol><p><img alt="SQS AWS" src="/aws/assets/images/sqs2-8509cd4157b61ff83f2092b32a73ada9.png"></p><ol start="4"><li><p>If the consumer has seen the message and knows it will take more than 30s to process, it can change the timeout using <code>ChangeMessageVisibility</code> API. This new timeout should be reasonable (not too long, not too short).</p></li><li><p>If the consumer fails to process the message within 30s (can be configured), it will be put back in the queue. If the failure happens again, the message will be keep coming back to the queue. After the <code>MaximumReceives</code> threshold, the message goes to a Dead Letter Queue (DLQ).</p></li><li><p>Make sure to process messages in DLQ before they expire.</p></li><li><p>Good to set a retention period of 14 days.</p></li><li><p>Delay Queue</p></li><li><p>Delay a message so the users don&#x27;t see it immediately (up to 15 minutes)</p></li><li><p>Default is 0s (message is available right away)</p></li><li><p>Can set a default at a queue level</p></li><li><p>Can override the default using the <code>DelaySeconds</code> parameter</p></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="iii-sqs-fifo"></a>III. SQS FIFO<a aria-hidden="true" tabindex="-1" class="hash-link" href="#iii-sqs-fifo" title="Direct link to heading">#</a></h2><ol><li>Limited throughput 300msgs/s and 3000msgs/s (with batching)</li><li>Exactly once send capability</li><li>Messages are processed in order by the consumer</li><li>Queue name has to end with <code>.fifo</code>. </li><li>You can use <code>GroupID</code> (similar to partition key in Kinesis) to send messages to different consumers.</li><li>SQS FIFO CANNOT sustain thousands of messages per second.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="iv-amazon-mq-migration"></a>IV. Amazon MQ (&quot;Migration&quot;)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#iv-amazon-mq-migration" title="Direct link to heading">#</a></h2><ol><li>SQS, SNS and Kinesis are cloud-native. If you are already using MQ protocol locally, you would not want to rewrite everything to fit into SQS. This is where Amazon MQ comes into play.</li><li>Amazon MQ = Managed Apache ActiveMQ</li><li>Doesn&#x27;t scale as much as SQS/SNS </li><li>Runs on a dedicated machine, can run in HA with failover</li><li>Has both queue and topic features</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="v-sqs-tips"></a>V. SQS Tips<a aria-hidden="true" tabindex="-1" class="hash-link" href="#v-sqs-tips" title="Direct link to heading">#</a></h2><ol><li>Poll the queue after a delayed duration (for 30s over keep-alive connection) to avoid polling too frequently. This is because you are charged per request.</li><li>Always remember that the messages in the SQS queue will continue to exist even after the EC2 instance has processed it, until you delete that message. <strong>You have to ensure that you delete the message after processing to prevent the message from being received and processed again once the visibility timeout expires. SQS does not automatically delete messages on its own.</strong></li><li><span style="background-color:#5a5a5a;border-radius:8px;color:#FF9900;padding:0.21rem">Long polling helps reduce the cost of using SQS by eliminating the number of empty responses</span> (when there are no messages available for a `ReceiveMessage` request) and false empty responses (when messages are available but aren&#x27;t included in a response).</li><li>In almost all cases, Amazon SQS long polling is preferable to short polling. Long-polling requests let your queue consumers receive messages as soon as they arrive in your queue while reducing the number of empty <code>ReceiveMessageResponse</code> instances returned.</li><li>Monitor SQS queues using CloudWatch. </li><li>Log SQS API calls with CloudTrail.</li><li>You can delete all messages in an Amazon SQS message queue using the <code>PurgeQueue</code> action.</li><li><strong>You CANNOT convert an existing standard queue to FIFO.</strong></li><li><strong>When setting up DLQ for FIFO, the DLQ itself must be FIFO as well.</strong></li><li>Queues can be encrypted using SSE (using KMS). SSE encrypts the body of a message but not the metadata.</li><li><strong>Messages are NOT encrypted by default.</strong></li><li>A single Amazon SQS message queue can contain an unlimited number of messages. However, there is a 120,000 limit for the number of inflight messages for a standard queue and 20,000 for a FIFO queue. Messages are inflight after they have been received from the queue by a consuming component, but have not yet been deleted from the queue.</li></ol></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/aws/docs/notes_bs"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">¬´ BeanStalk</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/aws/docs/notes_sns"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">SNS ¬ª</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#i-introduction" class="table-of-contents__link">I. Introduction</a></li><li><a href="#ii-message-visibility-timeout" class="table-of-contents__link">II. Message Visibility Timeout</a></li><li><a href="#iii-sqs-fifo" class="table-of-contents__link">III. SQS FIFO</a></li><li><a href="#iv-amazon-mq-migration" class="table-of-contents__link">IV. Amazon MQ (&quot;Migration&quot;)</a></li><li><a href="#v-sqs-tips" class="table-of-contents__link">V. SQS Tips</a></li></ul></div></div></div></div></main></div></div></div>
<script src="/aws/styles.e3d237d5.js"></script>
<script src="/aws/runtime~main.5987bc8c.js"></script>
<script src="/aws/main.db8832c0.js"></script>
<script src="/aws/2.eacc328a.js"></script>
<script src="/aws/3.5084f581.js"></script>
<script src="/aws/66.73ad6aef.js"></script>
<script src="/aws/67.520034c4.js"></script>
<script src="/aws/935f2afb.52a1d31c.js"></script>
<script src="/aws/17896441.17a33e11.js"></script>
<script src="/aws/7b0dd7dd.69cbd685.js"></script>
</body>
</html>